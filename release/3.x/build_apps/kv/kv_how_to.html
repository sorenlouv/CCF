<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Key-Value Serialisation" href="kv_serialisation.html" /><link rel="prev" title="Key-Value Store" href="index.html" />

    <link rel="shortcut icon" href="../../_static/favicon.ico"/><!-- Generated with Sphinx 7.1.2 and Furo 2024.01.29 -->
        <title>Key-Value Store How-To - CCF documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css?v=2a6c4383" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css?v=45cf7dbc" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css?v=d290406d" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=a4d5b81e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #3f3f3f;
  --color-code-foreground: #dcdccc;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #3f3f3f;
  --color-code-foreground: #dcdccc;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">CCF  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../_static/ccf.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../_static/ccf.svg" alt="Dark Logo"/>
  </div>
  
</a>

<script>
  function onVersionChange() {
    window.location.href = document.getElementById("versions").value;
  }

  window.addEventListener("DOMContentLoaded", function(){
      let selectedVersion = "main";
      const thisURL = window.location.toString();
      const splitUrl = thisURL.split("/");
      const indexOfRelease = splitUrl.indexOf("release");
      if (indexOfRelease > 0) {
        selectedVersion = splitUrl[indexOfRelease + 1];
      }
      let sel = document.getElementById("versions");
      if (sel != null) {
          let opts = sel.options;
          for (var opt, j = 0; opt = opts[j]; j++) {
              if (opt.text == selectedVersion) {
                  sel.selectedIndex = j;
                  break;
              }
          }
      }
  }, false);
</script>


<label for="versions">
  <div class="visually-hidden">Select Version:</div>
</label>
<select name="versions" id="versions" class="custom-select custom-select-sm" style="margin: 0em 1em;" onchange="onVersionChange()">
    <option value="../../../../main/build_apps/kv/kv_how_to.html">
      
        main
      
    </option>
    <option value="kv_how_to.html">
      
        3.x
      
    </option>
    <option value="../../../4.x/build_apps/kv/kv_how_to.html">
      
        4.x
      
    </option>
</select>
<form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../overview/index.html">Overview</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Overview</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../overview/what_is_ccf.html">What is CCF?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview/governance.html">Governance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview/performance.html">Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../overview/glossary.html">Glossary</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">Build Apps</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Build Apps</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../install_bin.html">Install CCF</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../example.html">C++ Application</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of C++ Application</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../example_cpp.html">Example app (C++)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example_rpc_api.html">Example app RPC API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../js_app_ts.html">TypeScript Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../js_app_bundle.html">JavaScript Application Bundle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../build_app.html">Build and Sign CCF Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../run_app.html">Running CCF Applications</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../auth/index.html">User Authentication</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of User Authentication</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../auth/jwt.html">JWT Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auth/cert.html">Certificate Authentication</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="index.html">Key-Value Store</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Key-Value Store</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">Key-Value Store How-To</a></li>
<li class="toctree-l3"><a class="reference internal" href="kv_serialisation.html">Key-Value Serialisation</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.html">Key-Value Store API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api.html">Developer API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../crypto.html">Cryptography API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release_policy.html">Release and compatibility policy</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../use_apps/index.html">Use Apps</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Use Apps</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../use_apps/issue_commands.html">Issuing Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../use_apps/verify_tx.html">Verifying Transactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../use_apps/verify_quote.html">Verifying Quote</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../use_apps/rpc_api.html">RPC API</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../operations/index.html">Operations</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Operations</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../operations/run_setup.html">Setup CCF Runtime Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/start_network.html">Running a CCF Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/configuration.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/ledger_snapshot.html">Ledger and Snapshots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/code_upgrade.html">Code Upgrade</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/certificates.html">Certificates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/recovery.html">Disaster Recovery</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/data_persistence.html">Data Persistence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/network.html">Networking</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../operations/platforms/index.html">Platforms</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of Platforms</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../operations/platforms/sgx.html">Intel SGX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../operations/platforms/snp.html">AMD SEV-SNP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../operations/platforms/virtual.html">Insecure Virtual</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/troubleshooting.html">Troubleshooting CCF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/resource_usage.html">Resource Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../operations/operator_rpc_api.html">Operator RPC API</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../governance/index.html">Governance</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Governance</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../governance/constitution.html">Constitution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../governance/proposals.html">Proposing and Voting for a Proposal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../governance/js_runtime.html">JavaScript Runtime Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../governance/open_network.html">Opening a Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../governance/accept_recovery.html">Accepting Recovery and Submitting Shares</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../governance/common_member_operations.html">Common Governance Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../governance/adding_member.html">Adding New Members</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../governance/hsm_keys.html">Using Member Keys Stored in HSM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../governance/member_rpc_api.html">Member RPC API</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../audit/index.html">Audit</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of Audit</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../audit/receipts.html">Receipts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../audit/builtin_maps.html">Built-in Maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../audit/python_library.html">Python Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../audit/read_write_restrictions.html">Read-Write Permissions On KV Maps</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../contribute/index.html">Contribute</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of Contribute</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../contribute/onboarding.html">Onboarding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contribute/create_vm.html">Create Azure SGX VM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contribute/build_setup.html">CCF Development Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contribute/build_ccf.html">Build CCF from Source</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contribute/release_ccf.html">Release or patch a CCF release</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contribute/build_images.html">CCF Build Images</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../architecture/index.html">Architecture</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of Architecture</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../architecture/consensus/index.html">Consensus Protocols</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of Consensus Protocols</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../architecture/consensus/1tx-reconfig.html">One-transaction Reconfiguration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../architecture/consensus/2tx-reconfig.html">Two-transaction Reconfiguration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/cryptography.html">Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/request_flow.html">Request Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/threading.html">Threading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/merkle_tree.html">Merkle Tree</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/ledger.html">Ledger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/raft_tla.html">TLA+ Specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/node_to_node.html">Node-to-Node Channels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/indexing.html">Indexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/receipts.html">Receipts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/tls_internals.html">TLS Internals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/tcp_internals.html">TCP Internals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/quic_internals.html">QUIC Internals</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../research/index.html">Research</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="key-value-store-how-to">
<h1>Key-Value Store How-To<a class="headerlink" href="#key-value-store-how-to" title="Permalink to this heading">#</a></h1>
<p>The <cite>Key-Value Store</cite> (KV) consists of a set of <a class="reference internal" href="api.html#_CPPv4I00EN2kv3MapE" title="kv::Map"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">kv::Map</span></code></a> objects that are available to the endpoints of an application. Endpoint handlers create handles which allow them to read and write from these <a class="reference internal" href="api.html#_CPPv4I00EN2kv3MapE" title="kv::Map"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">kv::Map</span></code></a> objects. The framework handles conflicts between concurrent execution of multiple transactions, and produces a consistent order of transactions which is replicated between nodes, allowing the entries to be read from multiple nodes. This page outlines the core concepts and C++ APIs used to interact with the KV.</p>
<section id="map-naming">
<h2>Map Naming<a class="headerlink" href="#map-naming" title="Permalink to this heading">#</a></h2>
<p>A <a class="reference internal" href="api.html#_CPPv4I00EN2kv3MapE" title="kv::Map"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">kv::Map</span></code></a> (often referred to as a <cite>Table</cite>) is a collection of key-value pairs of a given type. The <a class="reference internal" href="api.html#_CPPv4I00EN2kv3MapE" title="kv::Map"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">kv::Map</span></code></a> itself is identified by its name, which is used to lookup the map <a class="reference internal" href="api.html#_CPPv4I00EN2kv3MapE" title="kv::Map"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">kv::Map</span></code></a> from the local store during a transaction.</p>
<p>If a <a class="reference internal" href="api.html#_CPPv4I00EN2kv3MapE" title="kv::Map"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">kv::Map</span></code></a> with the given name did not previously exist, it will be created in this transaction.</p>
<p>A <a class="reference internal" href="api.html#_CPPv4I00EN2kv3MapE" title="kv::Map"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">kv::Map</span></code></a> can either be created as private (default) or public. Public map’s names begin with a <code class="docutils literal notranslate"><span class="pre">public:</span></code> prefix, any any other name indicates a private map. For instance the name <code class="docutils literal notranslate"><span class="pre">public:foo</span></code> to a public map, while <code class="docutils literal notranslate"><span class="pre">foo</span></code> refers to a private map. Transactions on private maps are written to the ledger in encrypted form and can only be decrypted in the enclave of nodes that have joined the network. Transactions on public maps are written to the ledger as plaintext and can be read from outside the enclave; only their integrity is protected. The security domain of a map (public or private) cannot be changed after its creation, since this is encoded in the map’s name. Public and private maps with similar names in different domains are distinct; writes to <code class="docutils literal notranslate"><span class="pre">public:foo</span></code> have no impact on <code class="docutils literal notranslate"><span class="pre">foo</span></code>, and vice versa.</p>
<p>Some table names are reserved for governance of a CCF service and cannot be modified by application code. For more information, see <a class="reference internal" href="../../audit/read_write_restrictions.html"><span class="doc">Read-Write Permissions On KV Maps</span></a>.</p>
</section>
<section id="transaction-semantics">
<h2>Transaction Semantics<a class="headerlink" href="#transaction-semantics" title="Permalink to this heading">#</a></h2>
<p>A transaction (<a class="reference internal" href="api.html#_CPPv4N2kv2TxE" title="kv::Tx"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">kv::Tx</span></code></a>) encapsulates an individual endpoint invocation’s atomic interaction with the KV. Transactions may read from and write to multiple <a class="reference internal" href="api.html#_CPPv4I00EN2kv3MapE" title="kv::Map"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">kv::Map</span></code></a>, and each is automatically ordered, applied, serialised, and committed by the framework.</p>
<p>A reference to a new <a class="reference internal" href="api.html#_CPPv4N2kv2TxE" title="kv::Tx"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">kv::Tx</span></code></a> is passed to each endpoint handler, and used to interact with the KV.</p>
<p>Each <a class="reference internal" href="api.html#_CPPv4N2kv2TxE" title="kv::Tx"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">kv::Tx</span></code></a> gets a consistent, opaque view of the KV, including the values which have been left by previous writes. Any writes produced by this transaction will be visible to all future transactions.</p>
<p>When the endpoint handler indicates that its <a class="reference internal" href="api.html#_CPPv4N2kv2TxE" title="kv::Tx"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">kv::Tx</span></code></a> should be applied (see <a class="reference internal" href="#applying-and-reverting-writes"><span class="std std-ref">this section</span></a> for details), the executing node attempts to apply the changes to its local KV. If this produces conflicts with concurrently executing transactions, it will be automatically re-executed. Once the transaction is applied successfully, it is automatically replicated to other nodes and will, if the network is healthy, eventually be committed.</p>
<p>For each <a class="reference internal" href="api.html#_CPPv4I00EN2kv3MapE" title="kv::Map"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">kv::Map</span></code></a> that a transaction wants to write to or read from, a <a class="reference internal" href="api.html#_CPPv4I0000EN2kv9MapHandleE" title="kv::MapHandle"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">kv::MapHandle</span></code></a> must first be acquired. These are acquired from the <a class="reference internal" href="api.html#_CPPv4I0EN2kv2Tx2rwEPN1M6HandleER1M" title="kv::Tx::rw"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">kv::Tx::rw()</span></code></a> (<cite>read-write</cite>) method. These may be acquired either by name (in which case the desired type must be explicitly specified as a template parameter), or by using a <a class="reference internal" href="api.html#_CPPv4I00EN2kv3MapE" title="kv::Map"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">kv::Map</span></code></a> instance which defines both the map’s name and key-value types.</p>
<p>By name:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Handle for map1</span>
<span class="k">auto</span><span class="w"> </span><span class="n">map1_handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tx</span><span class="p">.</span><span class="n">rw</span><span class="o">&lt;</span><span class="n">kv</span><span class="o">::</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;map1&quot;</span><span class="p">);</span>

<span class="c1">// Handles for 2 other maps, one public and one private, with different types</span>
<span class="k">auto</span><span class="w"> </span><span class="n">map2_handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tx</span><span class="p">.</span><span class="n">rw</span><span class="o">&lt;</span><span class="n">kv</span><span class="o">::</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64_t</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;public:map2&quot;</span><span class="p">);</span>
<span class="k">auto</span><span class="w"> </span><span class="n">map3_handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tx</span><span class="p">.</span><span class="n">rw</span><span class="o">&lt;</span><span class="n">kv</span><span class="o">::</span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">uint64_t</span><span class="p">,</span><span class="w"> </span><span class="n">MyCustomClass</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="s">&quot;map3&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>By <a class="reference internal" href="api.html#_CPPv4I00EN2kv3MapE" title="kv::Map"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">kv::Map</span></code></a>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">kv</span><span class="o">::</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">map_priv</span><span class="p">(</span><span class="s">&quot;map1&quot;</span><span class="p">);</span>
<span class="k">auto</span><span class="w"> </span><span class="n">map1_handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tx</span><span class="p">.</span><span class="n">rw</span><span class="p">(</span><span class="n">map_priv</span><span class="p">);</span>

<span class="n">kv</span><span class="o">::</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">map_pub</span><span class="p">(</span><span class="s">&quot;public:map2&quot;</span><span class="p">);</span>
<span class="k">auto</span><span class="w"> </span><span class="n">map2_handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tx</span><span class="p">.</span><span class="n">rw</span><span class="p">(</span><span class="n">map_pub</span><span class="p">);</span>

<span class="n">kv</span><span class="o">::</span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">uint64_t</span><span class="p">,</span><span class="w"> </span><span class="n">MyCustomClass</span><span class="o">&gt;</span><span class="w"> </span><span class="n">map_priv_int</span><span class="p">(</span><span class="s">&quot;map3&quot;</span><span class="p">);</span>
<span class="k">auto</span><span class="w"> </span><span class="n">map3_handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tx</span><span class="p">.</span><span class="n">rw</span><span class="p">(</span><span class="n">map_priv_int</span><span class="p">);</span>
</pre></div>
</div>
<p>The latter approach introduces a named binding between the map’s name and the types of its keys and values, reducing the chance for errors where code attempts to read a map with the wrong type.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As mentioned above, there is no need to explicitly declare a <a class="reference internal" href="api.html#_CPPv4I00EN2kv3MapE" title="kv::Map"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">kv::Map</span></code></a> before it is used. The first write to a <a class="reference internal" href="api.html#_CPPv4I00EN2kv3MapE" title="kv::Map"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">kv::Map</span></code></a> implicitly creates it in the underlying KV. Within a transaction, a newly created <a class="reference internal" href="api.html#_CPPv4I00EN2kv3MapE" title="kv::Map"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">kv::Map</span></code></a> behaves exactly the same as an existing <a class="reference internal" href="api.html#_CPPv4I00EN2kv3MapE" title="kv::Map"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">kv::Map</span></code></a> with no keys - the framework views these as semantically identical, and offers no way for the application logic to tell them apart. Any writes to a newly created <a class="reference internal" href="api.html#_CPPv4I00EN2kv3MapE" title="kv::Map"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">kv::Map</span></code></a> will be persisted when the transaction commits, and future transactions will be able to access this <a class="reference internal" href="api.html#_CPPv4I00EN2kv3MapE" title="kv::Map"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">kv::Map</span></code></a> by name to read those writes.</p>
</div>
</section>
<section id="accessing-map-content-via-a-handle">
<h2>Accessing Map content via a Handle<a class="headerlink" href="#accessing-map-content-via-a-handle" title="Permalink to this heading">#</a></h2>
<p>Once a <a class="reference internal" href="api.html#_CPPv4I0000EN2kv9MapHandleE" title="kv::MapHandle"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">kv::MapHandle</span></code></a> on a specific <a class="reference internal" href="api.html#_CPPv4I00EN2kv3MapE" title="kv::Map"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">kv::Map</span></code></a> has been obtained, it is possible to:</p>
<ul class="simple">
<li><p>test (<a class="reference internal" href="api.html#_CPPv4N2kv17ReadableMapHandle3hasERK1K" title="kv::ReadableMapHandle::has"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">kv::ReadableMapHandle::has()</span></code></a>) whether a key has any associated value;</p></li>
<li><p>read (<a class="reference internal" href="api.html#_CPPv4N2kv17ReadableMapHandle3getERK1K" title="kv::ReadableMapHandle::get"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">kv::ReadableMapHandle::get()</span></code></a>) the value associated with a key;</p></li>
<li><p>write (<a class="reference internal" href="api.html#_CPPv4N2kv18WriteableMapHandle3putERK1KRK1V" title="kv::WriteableMapHandle::put"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">kv::WriteableMapHandle::put()</span></code></a>) a new value for a key;</p></li>
<li><p>delete (<a class="reference internal" href="api.html#_CPPv4N2kv18WriteableMapHandle6removeERK1K" title="kv::WriteableMapHandle::remove"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">kv::WriteableMapHandle::remove()</span></code></a>) a key and its current value;</p></li>
<li><p>iterate (<a class="reference internal" href="api.html#_CPPv4I0EN2kv17ReadableMapHandle7foreachEvRR1F" title="kv::ReadableMapHandle::foreach"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">kv::ReadableMapHandle::foreach()</span></code></a>) through all key-value pairs.</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Writing to a handle</span>
<span class="n">map1_handle1</span><span class="o">-&gt;</span><span class="n">put</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;value1&quot;</span><span class="p">);</span>

<span class="c1">// Reading presence of a key</span>
<span class="kt">bool</span><span class="w"> </span><span class="n">has_key_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map1_handle</span><span class="o">-&gt;</span><span class="n">has</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">);</span>
<span class="n">assert</span><span class="p">(</span><span class="n">has_key_1</span><span class="p">);</span>

<span class="c1">// Reading a value</span>
<span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">read_val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map1_handle1</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">);</span>
<span class="n">assert</span><span class="p">(</span><span class="n">read_val</span><span class="p">.</span><span class="n">has_value</span><span class="p">());</span>
<span class="n">assert</span><span class="p">(</span><span class="n">read_val</span><span class="p">.</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;value1&quot;</span><span class="p">);</span>

<span class="c1">// Deleting a key</span>
<span class="n">map1_handle1</span><span class="o">-&gt;</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">);</span>

<span class="c1">// Reading a deleted/non-existent key</span>
<span class="n">assert</span><span class="p">(</span><span class="o">!</span><span class="n">map_handle1</span><span class="o">-&gt;</span><span class="n">has</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">));</span>
<span class="n">read_val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map1_handle1</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">);</span>
<span class="n">assert</span><span class="p">(</span><span class="o">!</span><span class="n">read_val</span><span class="p">.</span><span class="n">has_value</span><span class="p">());</span>
</pre></div>
</div>
</section>
<section id="read-write-safety">
<h2>Read/Write safety<a class="headerlink" href="#read-write-safety" title="Permalink to this heading">#</a></h2>
<p>If you are only reading from or only writing to a given <a class="reference internal" href="api.html#_CPPv4I00EN2kv3MapE" title="kv::Map"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">kv::Map</span></code></a> you can retrieve a <cite>read-only</cite> or <cite>write-only</cite> handle for it. This will turn unexpected reads/writes (which would introduce unintended dependencies between transactions) into compile-time errors. Instead of calling <a class="reference internal" href="api.html#_CPPv4I0EN2kv2Tx2rwEPN1M6HandleER1M" title="kv::Tx::rw"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">kv::Tx::rw()</span></code></a> to get a handle which can both read and write, you can call <a class="reference internal" href="api.html#_CPPv4I0EN2kv10ReadOnlyTx2roEPN1M14ReadOnlyHandleER1M" title="kv::ReadOnlyTx::ro"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">kv::ReadOnlyTx::ro()</span></code></a> to acquire a <cite>read-only</cite> handle or <a class="reference internal" href="api.html#_CPPv4I0EN2kv2Tx2woEPN1M15WriteOnlyHandleER1M" title="kv::Tx::wo"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">kv::Tx::wo()</span></code></a> to acquire a <cite>write-only</cite> handle.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Read-only handle for map_priv</span>
<span class="k">auto</span><span class="w"> </span><span class="n">map1_handle_ro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tx</span><span class="p">.</span><span class="n">ro</span><span class="p">(</span><span class="n">map_priv</span><span class="p">);</span>

<span class="c1">// Reading from that handle</span>
<span class="k">auto</span><span class="w"> </span><span class="n">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map1_handle_ro</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">);</span>
<span class="n">assert</span><span class="p">(</span><span class="n">v1</span><span class="p">.</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;value1&quot;</span><span class="p">);</span>

<span class="c1">// Writes are blocked at compile time</span>
<span class="n">map1_handle_ro</span><span class="o">-&gt;</span><span class="n">put</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;value2&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Does not compile</span>
<span class="n">map1_handle_ro</span><span class="o">-&gt;</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Does not compile</span>


<span class="c1">// Write-only handle for the same map</span>
<span class="k">auto</span><span class="w"> </span><span class="n">map1_handle_wo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tx</span><span class="p">.</span><span class="n">wo</span><span class="p">(</span><span class="n">map_priv</span><span class="p">);</span>

<span class="c1">// Write to that handle</span>
<span class="n">map1_handle_wo</span><span class="o">-&gt;</span><span class="n">put</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;value2&quot;</span><span class="p">);</span>

<span class="c1">// Reads are blocked at compile time</span>
<span class="n">map1_handle_wo</span><span class="o">-&gt;</span><span class="n">has</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Does not compile</span>
<span class="n">map1_handle_wo</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Does not compile</span>
</pre></div>
</div>
<p>Note that, as in the sample above, it is possible to acquire different kinds of handles at different points within your transaction’s execution. So if you need to read in one location and write in another you can retrieve multiple distinct handles and get local type-safety, while the resulting transaction correctly handles all reads and writes made.</p>
</section>
<section id="removing-a-key">
<h2>Removing a key<a class="headerlink" href="#removing-a-key" title="Permalink to this heading">#</a></h2>
<p>If a Key-Value pair was written to a <a class="reference internal" href="api.html#_CPPv4I00EN2kv3MapE" title="kv::Map"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">kv::Map</span></code></a> by a previous <a class="reference internal" href="api.html#_CPPv4N2kv2TxE" title="kv::Tx"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">kv::Tx</span></code></a>, it is possible to delete this key. Because of the append-only nature of the KV, this Key-Value pair is not actually removed from the <a class="reference internal" href="api.html#_CPPv4I00EN2kv3MapE" title="kv::Map"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">kv::Map</span></code></a> but instead explicitly marked as deleted in the version that the deleting <a class="reference internal" href="api.html#_CPPv4N2kv2TxE" title="kv::Tx"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">kv::Tx</span></code></a> is applied at.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// In transaction A, assuming that &quot;key1&quot; has already been written to</span>
<span class="k">auto</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tx</span><span class="p">.</span><span class="n">rw</span><span class="p">(</span><span class="n">map_priv</span><span class="p">);</span>
<span class="k">auto</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handle</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// v.value() == &quot;value1&quot;</span>
<span class="n">handle</span><span class="o">-&gt;</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">);</span>
<span class="k">auto</span><span class="w"> </span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tx</span><span class="p">.</span><span class="n">commit</span><span class="p">();</span>

<span class="c1">// In a later transaction B, which sees the state after A is applied</span>
<span class="k">auto</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tx</span><span class="p">.</span><span class="n">rw</span><span class="p">(</span><span class="n">map_priv</span><span class="p">);</span>
<span class="k">auto</span><span class="w"> </span><span class="n">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handle</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// v1.has_value() == false</span>
</pre></div>
</div>
</section>
<section id="global-commit">
<h2>Global commit<a class="headerlink" href="#global-commit" title="Permalink to this heading">#</a></h2>
<p>A transaction is automatically (globally) committed once the consensus protocol has established that a majority of nodes in the CCF network have successfully received and acknowledged that transaction. To operate on durable state, an application may want to query the globally committed state rather than the <em>current</em> state of the KV.</p>
<p>The <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">kv::MapHandle::get_globally_committed()</span></code> member function returns the value of a key that we know has been globally committed.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Assuming that &quot;key1&quot;:&quot;value1&quot; has already been committed</span>
<span class="k">auto</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tx</span><span class="p">.</span><span class="n">rw</span><span class="p">(</span><span class="n">map_priv</span><span class="p">);</span>

<span class="c1">// &quot;key1&quot; has not yet been globally committed</span>
<span class="k">auto</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handle</span><span class="p">.</span><span class="n">get_globally_committed</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">);</span>
<span class="n">assert</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">has_value</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Meanwhile, the CCF network globally commits the transaction in which &quot;key1&quot; was written</span>
<span class="k">auto</span><span class="w"> </span><span class="n">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handle</span><span class="p">.</span><span class="n">get_globally_committed</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// v1.has_value() == &quot;value1&quot;</span>
<span class="n">assert</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;value1&quot;</span><span class="p">);</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="miscellaneous">
<h2>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this heading">#</a></h2>
<section id="foreach">
<h3><code class="docutils literal notranslate"><span class="pre">foreach()</span></code><a class="headerlink" href="#foreach" title="Permalink to this heading">#</a></h3>
<p>Values can only be retrieved directly (<code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">kv::MapHandle::get()</span></code>) for a given target key. However, it is sometimes necessary to access unknown keys, or to iterate through all Key-Value pairs.</p>
<p>CCF offers a member function <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">kv::MapHandle::foreach()</span></code> to iterate over all the elements written to that <a class="reference internal" href="api.html#_CPPv4I00EN2kv3MapE" title="kv::Map"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">kv::Map</span></code></a> so far, and run a lambda function for each Key-Value pair. Note that a <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">kv::MapHandle::foreach</span></code> loop can be ended early by returning <code class="docutils literal notranslate"><span class="pre">false</span></code> from this lambda, while <code class="docutils literal notranslate"><span class="pre">true</span></code> should be returned to continue iteration.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>

<span class="c1">// Assuming that &quot;key1&quot;:&quot;value1&quot; and &quot;key2&quot;:&quot;value2&quot; have already been committed</span>
<span class="k">auto</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tx</span><span class="p">.</span><span class="n">rw</span><span class="p">(</span><span class="n">map_priv</span><span class="p">);</span>

<span class="c1">// Outputs:</span>
<span class="c1">//  key: key1 - value: value1</span>
<span class="c1">//  key: key2 - value: value2</span>
<span class="n">handle</span><span class="o">-&gt;</span><span class="n">foreach</span><span class="p">([](</span><span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; key: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; - value: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="cm">/* condition*/</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
</section>
<section id="applying-and-reverting-writes">
<h3>Applying and reverting writes<a class="headerlink" href="#applying-and-reverting-writes" title="Permalink to this heading">#</a></h3>
<p>Changes to the KV are made by atomic transactions. For a given <a class="reference internal" href="api.html#_CPPv4N2kv2TxE" title="kv::Tx"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">kv::Tx</span></code></a>, either all of its writes are applied, or none are. Only applied writes are replicated and may be globally committed. Transactions may be abandoned without applying their writes - their changes will never be seen by other transactions.</p>
<p>By default CCF decides which transactions are successful (so should be applied to the persistent store) by looking at the status code contained in the response: all transactions producing <code class="docutils literal notranslate"><span class="pre">2xx</span></code> status codes will be applied, while any other status code will be treated as an error and will <cite>not</cite> be applied to the persistent store. If this behaviour is not desired, for instance when an app wants to log incoming requests even though they produce an error, then it can be dynamically overridden by explicitly telling CCF whether it should apply a given transaction:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">args</span><span class="p">.</span><span class="n">rpc_ctx</span><span class="o">-&gt;</span><span class="n">set_response_status</span><span class="p">(</span><span class="n">HTTP_STATUS_FORBIDDEN</span><span class="p">);</span>
<span class="k">auto</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tx</span><span class="p">.</span><span class="n">rw</span><span class="p">(</span><span class="n">forbidden_requests</span><span class="p">);</span>

<span class="c1">// Log details of forbidden request</span>
<span class="n">handle</span><span class="o">-&gt;</span><span class="n">put</span><span class="p">(...);</span>

<span class="w"> </span><span class="c1">// Apply this, even though it has an error response</span>
<span class="n">args</span><span class="p">.</span><span class="n">rpc_ctx</span><span class="o">-&gt;</span><span class="n">set_apply_writes</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
  
        <div class="related-pages">
          <a class="next-page" href="kv_serialisation.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Key-Value Serialisation</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Key-Value Store</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2018, Microsoft Research
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
  <script>
    // Edit this page, on GitHub
    var contentIconContainer = document.querySelector(".content-icon-container");
    const editContent = `
    <div class="edit-this-page">
      <a class="muted-link" href="https://github.com/Microsoft/CCF/edit/main/doc/build_apps/kv/kv_how_to.rst">
        <svg viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
          <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" />
          <line x1="13.5" y1="6.5" x2="17.5" y2="10.5" />
        </svg>
      </a>
    </div>`;
    contentIconContainer.insertAdjacentHTML("afterbegin", editContent);

    // Show GitHub repository home
    var icons = document.querySelector(".icons")
    const repoLinkContent = `
    <a class="muted-link" href="https://github.com/Microsoft/CCF" aria-label="On GitHub">
      <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
      </svg>
    </a>`;
    icons.insertAdjacentHTML("beforeend", repoLinkContent);
  </script>

      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Key-Value Store How-To</a><ul>
<li><a class="reference internal" href="#map-naming">Map Naming</a></li>
<li><a class="reference internal" href="#transaction-semantics">Transaction Semantics</a></li>
<li><a class="reference internal" href="#accessing-map-content-via-a-handle">Accessing Map content via a Handle</a></li>
<li><a class="reference internal" href="#read-write-safety">Read/Write safety</a></li>
<li><a class="reference internal" href="#removing-a-key">Removing a key</a></li>
<li><a class="reference internal" href="#global-commit">Global commit</a></li>
<li><a class="reference internal" href="#miscellaneous">Miscellaneous</a><ul>
<li><a class="reference internal" href="#foreach"><code class="docutils literal notranslate"><span class="pre">foreach()</span></code></a></li>
<li><a class="reference internal" href="#applying-and-reverting-writes">Applying and reverting writes</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/tabs.js?v=3ee01567"></script>
    <script src="https://kit.fontawesome.com/c75a35380d.js"></script>
    </body>
</html>